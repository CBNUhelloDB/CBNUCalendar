
<!-- Club header section -->
  <div class="list-group">
    
    
<?php
include_once 'dbconfig.php';
$dbname = "events_calendar";
mysqli_select_db($conn, $dbname) or die('DB selection failed');

if (mysqli_connect_errno()) {
  echo "Failed to connect to MySQL: " . mysqli_connect_error();
  exit();
}else{
  // echo "Connection successful!<br>";	
}


// get club name
$sql_club_name = "
	SELECT id, name
	FROM club
";
$result_club_name = $conn->query($sql_club_name);
$row_club_name = mysqli_fetch_array($result_club_name);

	// ## Begin: get first club name and its manager
	// The while loop starts from the second row of the query, that's why this part is necessary
	echo '<a href="'.$row_club_name["id"].'" class="list-group-item list-group-item-action flex-column align-items-start">';
	echo '<div class="d-flex w-100 justify-content-between">';
	echo '<h5 class="mb-1"><strong>Club ID: </strong>' . $row_club_name["id"] . '</h5><br>';
	echo '</div>';	
	
	echo '<div class="d-flex w-100 justify-content-between">';
	echo '<h5 class="mb-1"><strong>Club name: </strong>' . $row_club_name["name"] . '</h5><br>';
	echo '</div>';	
	
	if($result_club_name->num_rows > 0){

	// get club manager using club id
	$sql_club_manager = "
		SELECT full_name
		FROM club
		JOIN user
		ON club.manager_id = user.id
		WHERE club.id =" . $row_club_name["id"] . "
	";
	$result_club_manager = $conn->query($sql_club_manager);
	$row_club_manager = mysqli_fetch_array($result_club_manager);

	echo '<div class="d-flex w-100 justify-content-between">';
	echo '<h5 class="mb-1"><strong>Club manager: </strong>' . $row_club_manager["full_name"] . '</5>';
	echo '</div>';	

	// get club member using club id
	// get members and exclude the manager of the respectvive group
	$sql_member = "
		SELECT full_name FROM user, club_member
		WHERE user.id = club_member.user_id
		AND club_member.club_id =".$row_club_name["id"]."
		AND user.full_name NOT IN (
			SELECT full_name
			FROM user
			JOIN club
			ON user.id = club.manager_id
			WHERE club.id =".$row_club_name["id"].")
	";
	$result_member = $conn->query($sql_member);
	$row_member = mysqli_fetch_array($result_member);
	
	if($result_member->num_rows > 0){
		// output data of each row
		echo "<h5><strong>Club members: </strong>" . $row_member["full_name"] . ", ";

		while($row_member = $result_member->fetch_assoc()){
			echo $row_member["full_name"] . ", ";
		}
		echo '</h5>';
	}
	// ## End

	// ## BEGIN OUTER WHILE-LOOP
	// output data of each row
	while($row_club_name = $result_club_name->fetch_assoc()){

	echo '<a href="'. $row_club_name["id"] .'" class="list-group-item list-group-item-action flex-column align-items-start">';
	echo '<div class="d-flex w-100 justify-content-between">';
	echo '<h5 class="mb-1"><strong>Club ID: </strong>' . $row_club_name["id"] . '</h5><br>';
	echo '</div>';		
	
	echo '<div class="d-flex w-100 justify-content-between">';
	echo '<h5 class="mb-1"><strong>Club name: </strong>' . $row_club_name["name"] . '</h5><br>';
	echo '</div>';	

	// get club manager using club id
	$sql_club_manager = "
		SELECT full_name
		FROM club
		JOIN user
		ON club.manager_id = user.id
		WHERE club.id =" . $row_club_name["id"] . "
	";
	$result_club_manager = $conn->query($sql_club_manager);
	$row_club_manager = mysqli_fetch_array($result_club_manager);

	echo '<div class="d-flex w-100 justify-content-between">';
	echo '<h5 class="mb-1"><strong>Club manager: </strong>' . $row_club_manager["full_name"] . '</h5>';
	echo '</div>';

	$sql_member = "
		SELECT full_name FROM user, club_member
		WHERE user.id = club_member.user_id
		AND club_member.club_id =".$row_club_name["id"]."
		AND user.full_name NOT IN (
			SELECT full_name
			FROM user
			JOIN club
			ON user.id = club.manager_id
			WHERE club.id =".$row_club_name["id"].")
	";
	$result_member = $conn->query($sql_member);
	$row_member = mysqli_fetch_array($result_member);

	if($result_member->num_rows > 0){
		// output data of each row
		echo "<h5><strong>Club members: </strong>" . $row_member["full_name"] . ", ";
		while($row_member = $result_member->fetch_assoc()){
			echo $row_member["full_name"] . ", ";
		}
		echo '</h5>';
	}
	}   // ## END OUTER WHILE-LOOP
}

mysqli_close($conn);
?>    
